import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
from mpl_toolkits.mplot3d.art3d import Poly3DCollection
from scipy.interpolate import splrep, splev


# # B样条曲线插值例子
# # 创建一个画布和三维坐标轴
# fig = plt.figure()
# ax = fig.add_subplot(111, projection='3d')
#
# # 设置坐标轴标签
# ax.set_xlabel('X')
# ax.set_ylabel('Y')
# ax.set_zlabel('Z')
#
# Path_points =[[ 0.4199446 , -0.35013372,  1.06160904],
#        [ 0.41994235, -0.35039067,  1.06150101],
#        [ 0.41993543, -0.35050464,  1.06147741],
#        [ 0.41992419, -0.35057054,  1.06144132],
#        [ 0.41990843, -0.35059741,  1.06142016],
#        [ 0.41988746, -0.35057876,  1.06141184],
#        [ 0.41986067, -0.35051935,  1.06141432],
#        [ 0.41982045, -0.35041951,  1.06142847],
#        [ 0.41975171, -0.35022901,  1.06147412],
#        [ 0.41953869, -0.3498765 ,  1.06150775],
#        [ 0.4191602 , -0.3493174 ,  1.06153003],
#        [ 0.41865538, -0.34857318,  1.06155559],
#        [ 0.41806979, -0.34773653,  1.0615629 ],
#        [ 0.41742704, -0.34685287,  1.06156349],
#        [ 0.41668847, -0.34591635,  1.06156029],
#        [ 0.41586354, -0.34494631,  1.06154519],
#        [ 0.4149909 , -0.3439531 ,  1.06152013],
#        [ 0.41407796, -0.34292291,  1.06150368],
#        [ 0.41311643, -0.34186012,  1.06148115],
#        [ 0.41209886, -0.340758  ,  1.06146844],
#        [ 0.41097635, -0.33965537,  1.06139959],
#        [ 0.40981338, -0.33848883,  1.06133024],
#        [ 0.40860799, -0.33726338,  1.06126929],
#        [ 0.40736643, -0.33598471,  1.06121274],
#        [ 0.40611606, -0.33464424,  1.06117622],
#        [ 0.40481495, -0.33326866,  1.06111803],
#        [ 0.40347259, -0.33185482,  1.06106743],
#        [ 0.40209449, -0.33041044,  1.06101422],
#        [ 0.40069156, -0.32894306,  1.06096209],
#        [ 0.39926822, -0.32745537,  1.06091266],
#        [ 0.39782355, -0.32595803,  1.06085884],
#        [ 0.39637044, -0.32444688,  1.06081283],
#        [ 0.39490877, -0.32293287,  1.06076578],
#        [ 0.39345161, -0.32141394,  1.060729  ],
#        [ 0.39199491, -0.31990034,  1.06069248],
#        [ 0.39054885, -0.31839088,  1.06066623],
#        [ 0.38910974, -0.31690423,  1.06065157],
#        [ 0.38764851, -0.31543395,  1.06062315],
#        [ 0.38621162, -0.31396902,  1.06057807],
#        [ 0.38479073, -0.31252955,  1.06054295],
#        [ 0.38341779, -0.3110846 ,  1.06054033],
#        [ 0.38205542, -0.30966825,  1.06053382],
#        [ 0.38069901, -0.3082794 ,  1.06053153],
#        [ 0.37934925, -0.30692039,  1.06053327],
#        [ 0.37799722, -0.30562426,  1.06056295],
#        [ 0.37665822, -0.30431673,  1.06056881],
#        [ 0.37533418, -0.30302152,  1.06057024],
#        [ 0.37401368, -0.3017483 ,  1.06057476],
#        [ 0.37269482, -0.30049461,  1.06058027],
#        [ 0.37137903, -0.29924808,  1.06058074],
#        [ 0.37006297, -0.29801839,  1.06058407],
#        [ 0.36874438, -0.29680098,  1.06058792],
#        [ 0.36742252, -0.29559278,  1.06059183],
#        [ 0.36609649, -0.29439009,  1.06059458],
#        [ 0.36476528, -0.29319036,  1.06059538],
#        [ 0.36342663, -0.29199715,  1.06059743],
#        [ 0.36210078, -0.29078683,  1.06061494],
#        [ 0.36079071, -0.28957328,  1.06065428],
#        [ 0.35943604, -0.28838552,  1.06064703],
#        [ 0.35806328, -0.28720562,  1.06064945],
#        [ 0.35667795, -0.28602672,  1.06065261],
#        [ 0.35527547, -0.28484667,  1.06062951],
#        [ 0.3538705 , -0.28366599,  1.0606174 ],
#        [ 0.35246626, -0.28247992,  1.0606154 ],
#        [ 0.3510492 , -0.2813147 ,  1.06061828],
#        [ 0.34962398, -0.28015054,  1.06061543],
#        [ 0.34818085, -0.27902305,  1.06061209],
#        [ 0.34674581, -0.2778702 ,  1.06060254],
#        [ 0.34531615, -0.27671804,  1.06059416],
#        [ 0.34388727, -0.27557312,  1.06058463],
#        [ 0.34246396, -0.274431  ,  1.06057871],
#        [ 0.34104106, -0.2733029 ,  1.06057172],
#        [ 0.33962397, -0.27218081,  1.06057283],
#        [ 0.33818863, -0.27107416,  1.0605715 ],
#        [ 0.33673811, -0.26996384,  1.06056957],
#        [ 0.3352813 , -0.26885001,  1.06057729],
#        [ 0.33380912, -0.26774043,  1.06058439],
#        [ 0.33231574, -0.26663596,  1.0605903 ],
#        [ 0.33080578, -0.26552823,  1.06060174],
#        [ 0.32927172, -0.26442415,  1.06061123],
#        [ 0.32776082, -0.26332832,  1.06061915],
#        [ 0.32633698, -0.26226446,  1.0606275 ],
#        [ 0.32499474, -0.2612594 ,  1.06062386],
#        [ 0.32373603, -0.26030288,  1.06061624],
#        [ 0.32258039, -0.25939206,  1.06060868],
#        [ 0.3215218 , -0.25853835,  1.06056271],
#        [ 0.32059927, -0.25774439,  1.06052884],
#        [ 0.31980403, -0.2570257 ,  1.06050171],
#        [ 0.31906335, -0.25636181,  1.06044958],
#        [ 0.31836942, -0.25575823,  1.06045071],
#        [ 0.31770252, -0.25519668,  1.06046111],
#        [ 0.31707251, -0.25466729,  1.06048453],
#        [ 0.31647483, -0.25416594,  1.06052705],
#        [ 0.31589363, -0.25369731,  1.0605805 ],
#        [ 0.31532845, -0.25324971,  1.06065194],
#        [ 0.31478087, -0.25282707,  1.06074154],
#        [ 0.31424979, -0.25240198,  1.06086165],
#        [ 0.3138613 , -0.25209734,  1.060893  ],
#        [ 0.31348433, -0.25175768,  1.0610563 ],
#        [ 0.31296685, -0.25133312,  1.06129377],
#        [ 0.31239793, -0.25086988,  1.06124993],
#        [ 0.31201231, -0.25055215,  1.06123968],
#        [ 0.31174004, -0.25033376,  1.06126383],
#        [ 0.31152798, -0.25016979,  1.06129979],
#        [ 0.3113599 , -0.25002608,  1.06132663],
#        [ 0.31123431, -0.24990183,  1.06135128],
#        [ 0.3111404 , -0.24981067,  1.0613739 ],
#        [ 0.31107393, -0.2497528 ,  1.06139868],
#        [ 0.31102726, -0.24970483,  1.06141795],
#        [ 0.31098811, -0.24966082,  1.06143228],
#        [ 0.3109517 , -0.24961794,  1.06144594],
#        [ 0.31091597, -0.2495824 ,  1.06145874],
#        [ 0.3108805 , -0.24955455,  1.06147223],
#        [ 0.31084624, -0.24952274,  1.06148194],
#        [ 0.31080965, -0.24955267,  1.06151149],
#        [ 0.31077749, -0.24954919,  1.06152827],
#        [ 0.31074783, -0.24952311,  1.06153895],
#        [ 0.31071828, -0.24949581,  1.06155074],
#        [ 0.31068887, -0.24946477,  1.06156188],
#        [ 0.31065988, -0.24943051,  1.06157149],
#        [ 0.31063239, -0.24939988,  1.06158237],
#        [ 0.31060504, -0.24937344,  1.06159206],
#        [ 0.31057815, -0.24934375,  1.06159839],
#        [ 0.31055245, -0.24932081,  1.06160886],
#        [ 0.31052793, -0.24929039,  1.06161519],
#        [ 0.31050288, -0.24926294,  1.06162129],
#        [ 0.31048023, -0.24924203,  1.06163032],
#        [ 0.31045685, -0.24921232,  1.06163469],
#        [ 0.31043431, -0.24919299,  1.06164102],
#        [ 0.31041246, -0.2491733 ,  1.06164592],
#        [ 0.31039204, -0.24915467,  1.06165154],
#        [ 0.31037102, -0.24913292,  1.06165389],
#        [ 0.31035218, -0.24910935,  1.06165928],
#        [ 0.31033245, -0.24908642,  1.06166288],
#        [ 0.31031399, -0.24906603,  1.0616658 ],
#        [ 0.31029587, -0.24904958,  1.06167071],
#        [ 0.31027864, -0.24903676,  1.06167467],
#        [ 0.31026117, -0.24902008,  1.06167569],
#        [ 0.31024516, -0.24900565,  1.06168002],
#        [ 0.31022947, -0.24899159,  1.06168324],
#        [ 0.31021423, -0.24897367,  1.06168563],
#        [ 0.31019889, -0.24895832,  1.06168739],
#        [ 0.31018417, -0.24894105,  1.06168995],
#        [ 0.31017043, -0.24892631,  1.06169365],
#        [ 0.31015651, -0.2489064 ,  1.06169564],
#        [ 0.31014277, -0.24889326,  1.06169837],
#        [ 0.31012997, -0.24888005,  1.0617005 ],
#        [ 0.31011743, -0.2488695 ,  1.06170325],
#        [ 0.310105  , -0.24885689,  1.06170446],
#        [ 0.31009382, -0.24884829,  1.06170735],
#        [ 0.31008227, -0.24883375,  1.06170821],
#        [ 0.3100711 , -0.24882095,  1.06170937],
#        [ 0.31005998, -0.24880957,  1.06171165],
#        [ 0.31004976, -0.24879788,  1.06171348],
#        [ 0.31003976, -0.24878515,  1.06171494],
#        [ 0.31002969, -0.24877013,  1.06171662],
#        [ 0.31001974, -0.24875951,  1.06171831],
#        [ 0.31001083, -0.2487474 ,  1.06171967],
#        [ 0.3100015 , -0.24873824,  1.06172118],
#        [ 0.30999293, -0.24872377,  1.06172219],
#        [ 0.30998428, -0.2487146 ,  1.06172413],
#        [ 0.30997641, -0.24870135,  1.06172566],
#        [ 0.30996799, -0.24868933,  1.06172665],
#        [ 0.30996036, -0.24868131,  1.06172869],
#        [ 0.30995282, -0.24866721,  1.06172878],
#        [ 0.30994528, -0.2486578 ,  1.06173114],
#        [ 0.30993845, -0.24864938,  1.06173285],
#        [ 0.30993156, -0.24863818,  1.06173362],
#        [ 0.30992533, -0.24862659,  1.06173531],
#        [ 0.30991818, -0.24861429,  1.06173583],
#        [ 0.30991194, -0.24860447,  1.06173734],
#        [ 0.30990609, -0.24859197,  1.06173762],
#        [ 0.30990056, -0.24858238,  1.06174008],
#        [ 0.30989451, -0.24857045,  1.06174072],
#        [ 0.30988921, -0.24856181,  1.06174228],
#        [ 0.30988388, -0.24855306,  1.06174285],
#        [ 0.30987895, -0.24854212,  1.06174441],
#        [ 0.30987383, -0.24853175,  1.06174573],
#        [ 0.30986913, -0.24852296,  1.06174661],
#        [ 0.30986474, -0.24851265,  1.0617471 ],
#        [ 0.30986032, -0.24850396,  1.06174839],
#        [ 0.30985577, -0.24849351,  1.06174893],
#        [ 0.3098516 , -0.24848463,  1.06174955],
#        [ 0.30984773, -0.24847354,  1.06175089],
#        [ 0.30984362, -0.24846399,  1.06175105],
#        [ 0.30984016, -0.24845273,  1.06175256],
#        [ 0.3098364 , -0.24844613,  1.06175362],
#        [ 0.30983339, -0.24843691,  1.06175447],
#        [ 0.30982987, -0.2484248 ,  1.06175381],
#        [ 0.30982717, -0.24841499,  1.06175582],
#        [ 0.30982353, -0.24840776,  1.06175726],
#        [ 0.30982061, -0.2483994 ,  1.06175733],
#        [ 0.30981798, -0.24838874,  1.06175839],
#        [ 0.30981536, -0.24838317,  1.06175954],
#        [ 0.30981261, -0.24837589,  1.06175917],
#        [ 0.30981067, -0.24836231,  1.06175972],
#        [ 0.30980779, -0.2483564 ,  1.06176082],
#        [ 0.30980575, -0.24834792,  1.06176176],
#        [ 0.30980371, -0.24834087,  1.06176255],
#        [ 0.30980149, -0.24833099,  1.06176323],
#        [ 0.30979937, -0.24832344,  1.06176375],
#        [ 0.30979798, -0.24831596,  1.06176463],
#        [ 0.30979612, -0.24830586,  1.06176384],
#        [ 0.30979427, -0.24829971,  1.06176519],
#        [ 0.30979265, -0.24829235,  1.0617657 ],
#        [ 0.30979096, -0.24828282,  1.06176571],
#        [ 0.30978966, -0.24827451,  1.06176579],
#        [ 0.30978821, -0.24826646,  1.06176664],
#        [ 0.30978704, -0.24826107,  1.06176793],
#        [ 0.30978601, -0.24825538,  1.0617684 ],
#        [ 0.30978495, -0.24824881,  1.06176881],
#        [ 0.30978386, -0.24823618,  1.06176701],
#        [ 0.30978275, -0.24822798,  1.06176862],
#        [ 0.30978171, -0.24822256,  1.06176956],
#        [ 0.30978081, -0.24821319,  1.06176975],
#        [ 0.30977961, -0.24820509,  1.06176978],
#        [ 0.30977898, -0.24819651,  1.06177081],
#        [ 0.30977786, -0.24818823,  1.06177068],
#        [ 0.30977724, -0.24818344,  1.0617719 ],
#        [ 0.30977642, -0.24817587,  1.06177204],
#        [ 0.30977556, -0.24816787,  1.06177206],
#        [ 0.30977528, -0.2481574 ,  1.06177155],
#        [ 0.30977447, -0.24815171,  1.06177262],
#        [ 0.3097743 , -0.24814444,  1.06177294],
#        [ 0.30977339, -0.24813549,  1.06177289],
#        [ 0.30977269, -0.24812839,  1.06177341],
#        [ 0.30977251, -0.24812175,  1.06177403],
#        [ 0.30977233, -0.24811008,  1.06177261],
#        [ 0.30977175, -0.24810518,  1.06177417],
#        [ 0.30977153, -0.24809911,  1.06177455],
#        [ 0.30977154, -0.24809098,  1.06177427],
#        [ 0.30977101, -0.24808554,  1.06177497],
#        [ 0.30977113, -0.24807308,  1.06177385],
#        [ 0.30977029, -0.24806502,  1.06177424],
#        [ 0.30977035, -0.24805785,  1.061775  ],
#        [ 0.30977024, -0.24805191,  1.0617751 ],
#        [ 0.30976981, -0.24804482,  1.0617758 ],
#        [ 0.30976951, -0.24804059,  1.06177663],
#        [ 0.30977001, -0.24802915,  1.06177537],
#        [ 0.30976964, -0.24802476,  1.06177648]]
# Path_points = np.array(Path_points)
# ax.plot3D(Path_points[:, 0], Path_points[:, 1], Path_points[:, 2])
# plt.show()
#
# # 分别对每个坐标轴进行插值
# t = np.arange(len(Path_points))
# tck_x = splrep(t, Path_points[:, 0], k=2, s=0)
# tck_y = splrep(t, Path_points[:, 1], k=2, s=0)
# tck_z = splrep(t, Path_points[:, 2], k=2, s=0)
#
# # 生成插值后的坐标点
# t_new = np.linspace(0, len(Path_points) - 1, 100)
# x_new = splev(t_new, tck_x)
# y_new = splev(t_new, tck_y)
# z_new = splev(t_new, tck_z)
#
# # 绘制原始点和插值后的曲线
# fig = plt.figure()
# ax = fig.add_subplot(111, projection='3d')
# # ax.scatter(Path_points[:, 0], Path_points[:, 1], Path_points[:, 2], color='red', label='Original Points')
# ax.scatter(0.16478348, -0.49979677, 1.06, color='orange', label='Joint Point')
# ax.scatter(0.31078039, -0.24234579, 1.06, color='red', label='End Point')
# ax.plot(x_new, y_new, z_new, color='blue', label='Smoothed Curve')
# ax.set_xlabel('X')
# ax.set_ylabel('Y')
# ax.set_zlabel('Z')
# ax.set_title('Quadratic B-Spline Interpolation in 3D')
# ax.legend()
# plt.show()

##力和轨迹曲线例程
freq_force = 20
force_x = np.loadtxt(r'figs/force_x_adaption.txt')
force_y = np.loadtxt(r'figs/force_y_adaption.txt')
force_z = np.loadtxt(r'figs/force_z_adaption.txt')
plt.subplot(3, 1, 1)
plt.plot(np.arange(len(force_x)) / freq_force, force_x, linewidth=1.5, color='b')
plt.xticks(fontsize=1, fontproperties='Times New Roman')
plt.yticks(fontsize=18, fontproperties='Times New Roman')
plt.ylabel("Fx/N", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.subplot(3, 1, 2)
plt.plot(np.arange(len(force_y)) / freq_force, force_y, linewidth=1.5, color='b')
plt.xticks(fontsize=1, fontproperties='Times New Roman')
plt.yticks(fontsize=18, fontproperties='Times New Roman')
plt.ylabel("Fy/N", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.subplot(3, 1, 3)
plt.plot(np.arange(len(force_z)) / freq_force, force_z, linewidth=1.5, color='b')
plt.xticks(fontsize=18, fontproperties='Times New Roman')
plt.yticks(fontsize=18, fontproperties='Times New Roman')
plt.ylabel("Fz/N", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.xlabel("time/s", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.show()

##带圆心的运动轨迹
plt.figure()
path = np.loadtxt(r'figs/path_adaption.txt')
plt.plot(path[:,0], path[:,1], linewidth=1.5, color='b')
plt.xticks(fontsize=18, fontproperties='Times New Roman')
plt.yticks(fontsize=18, fontproperties='Times New Roman')
plt.scatter(0.17, -0.45, color='green')
plt.scatter(0.316, -0.212, color='red')
plt.xlabel("X/m", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.ylabel("Y/m", fontsize=20, fontdict={'family': 'Times New Roman'})
plt.show()
